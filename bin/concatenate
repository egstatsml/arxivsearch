#!/usr/bin/env python

import arxivpy
import feedparser
import datetime
import pandas as pd

from arxivsearch.catagory import catagory, get_catagory

import os
import argparse
import sys













def main(arguments):
    """
    main()
    Description:
    Will update the list of papers
    """
    parser = argparse.ArgumentParser(prog="main",
                                     epilog=main.__doc__)
    parser.add_argument('catagory', type=str, default='bnn',
                        help="catagory we want to search for")
    parser.add_argument('--days', type=int, default=7,
                        help="nuymber of days we want to search back for")
    parser.add_argument('--num', type=int, default=0,
                        help="number of papers to find")
    args = parser.parse_args(arguments)
    search_catagory = get_catagory(args.catagory)
    
    #read in the temp file
    with open(os.path.join(args.catagory, 'nor.md'), 'r') as temp:
        temp_lines = temp.readlines()
    #see if the actual file exists

    #if an original readme file exists, lets read it and then prepend
    #the data too it
    if(os.path.isfile(os.path.join(args.catagory, 'README.md'))):
        readme = open(os.path.join(args.catagory, 'README.md'), 'r')
        readme_lines = readme.readlines()
        readme.close()
    else:
        readme_lines = []
        
    #open the file so we can write to it now
    readme = open(os.path.join(args.catagory, 'README.md'), 'w')
    #remove the first line of the readme file as thic contains the title
    readme_lines = readme_lines[1:]

    new_readme = []
    new_readme.extend(['#{}'.format(datetime.datetime.now()), ' \n'])
    new_readme.extend(temp_lines)
    new_readme.extend([' ', ' '])
    new_readme.extend(readme_lines)
    readme.write('\n'.join(new_readme) + '\n')
    #now close the file
    readme.close()
    
       
if __name__ == "__main__":
    sys.exit(main(sys.argv[1:]))
